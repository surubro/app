<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Future Date App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
    margin:0;
    font-family:system-ui,Arial;
    background:#f2f2f2;
}
.box{
    max-width:420px;
    margin:20px auto;
    background:#fff;
    padding:20px;
    border-radius:8px;
}
input,button{
    width:100%;
    padding:10px;
    margin-top:10px;
    font-size:16px;
}
button{ cursor:pointer }
.hidden{ display:none }
.record{
    border-bottom:1px solid #ddd;
    padding:8px 0;
}
.del{
    background:#ff4d4d;
    color:#fff;
    border:none;
    padding:6px;
    margin-top:5px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
    <h3>Login / Register</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
</div>

<!-- APP -->
<div class="box hidden" id="appBox">
    <h3>Future Date Calculator</h3>

    <input type="text" id="textInput" placeholder="Enter text">
    <input type="date" id="dateInput">
    <input type="number" id="daysInput" placeholder="Enter days (e.g. 30)" min="1">
    <button onclick="saveData()">Calculate & Save</button>

    <div id="result"></div>

    <button onclick="logout()">Logout</button>
</div>

<script>
/* ========== FIREBASE CONFIG ========== */
const firebaseConfig = {
    apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
    authDomain: "striped-acrobat-342207.firebaseapp.com",
    databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
    projectId: "striped-acrobat-342207"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.database();

/* ========== AUTH STATE ========== */
auth.onAuthStateChanged(user=>{
    if(user){
        loginBox.classList.add("hidden");
        appBox.classList.remove("hidden");
        loadData();
    }
});

/* ========== AUTH ========== */
function login(){
    auth.signInWithEmailAndPassword(email.value,password.value)
        .catch(e=>alert(e.message));
}

function register(){
    auth.createUserWithEmailAndPassword(email.value,password.value)
        .catch(e=>alert(e.message));
}

function logout(){
    auth.signOut();
    location.reload();
}

/* ========== SAVE DATA ========== */
function saveData(){
    const text = textInput.value.trim();
    const dateVal = dateInput.value;
    const days = parseInt(daysInput.value);

    if(!dateVal || !days || days < 1){
        alert("Select date and enter valid days");
        return;
    }

    const d = new Date(dateVal);
    d.setDate(d.getDate() + days);
    const futureDate = d.toISOString().split("T")[0];

    const uid = auth.currentUser.uid;

    db.ref("future-date/"+uid).push({
        text,
        startDate: dateVal,
        daysAdded: days,
        futureDate,
        time: Date.now()
    });

    textInput.value="";
    dateInput.value="";
    daysInput.value="";

    loadData();
}

/* ========== LOAD DATA ========== */
function loadData(){
    const uid = auth.currentUser.uid;
    const box = document.getElementById("result");

    box.innerHTML = "<h4>Saved Records</h4>";

    db.ref("future-date/"+uid).once("value",snap=>{
        if(!snap.exists()){
            box.innerHTML += "<p>No records found</p>";
            return;
        }

        snap.forEach(child=>{
            const d = child.val();
            const key = child.key;

            box.innerHTML += `
                <div class="record">
                    <b>${d.text || "No text"}</b><br>
                    Start: ${d.startDate}<br>
                    Days Added: ${d.daysAdded}<br>
                    Result Date: <b>${d.futureDate}</b>
                    <button class="del" onclick="deleteEntry('${key}')">Delete</button>
                </div>
            `;
        });
    });
}

/* ========== DELETE ENTRY ========== */
function deleteEntry(key){
    const uid = auth.currentUser.uid;

    if(confirm("Delete this entry?")){
        db.ref("future-date/"+uid+"/"+key).remove()
            .then(loadData);
    }
}
</script>

</body>
</html>
