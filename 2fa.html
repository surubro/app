<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>TOTP Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 420px;
    margin: auto;
  }
  h2 { text-align: center; }
  input {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    box-sizing: border-box;
  }
  button {
    margin-top: 6px;
    padding: 8px;
    width: 100%;
  }
  .account-btn {
    display: block;
    width: 100%;
    text-align: left;
    margin: 3px 0;
  }
  .otp {
    font-size: 38px;
    font-weight: bold;
    text-align: center;
    margin-top: 15px;
  }
  .timer {
    text-align: center;
    color: #555;
    margin-top: 5px;
  }
  details { margin-top: 10px; }
</style>
</head>
<body>

<h2>TOTP Generator</h2>

<!-- Input box (like before) -->

<label>Enter Secret Key:</label> <input id="customKey" placeholder="BASE32 SECRET"> <button onclick="generateFromInput()">Generate OTP</button>

<!-- Preset Accounts -->

<details>
  <summary><b>Show Accounts (20)</b></summary>
  <div id="accounts"></div>
</details>

<div class="otp" id="otpDisplay">------</div>
<div class="timer">Expires in <span id="timeLeft">30</span>s</div>

<script>
/* ===== ACCOUNTS WITH NAMES ===== */
const accounts = [
  { name: "Google", secret: "JBSWY3DPEHPK3PXP" },
  { name: "GitHub", secret: "KRSXG5DSNFXGOIDB" },
  { name: "Facebook", secret: "MFRGGZDFMZTWQ2LK" },
  { name: "Amazon", secret: "GEZDGNBVGY3TQOJQ" },
  { name: "Microsoft", secret: "JZXW6YTBOI======" },
  { name: "PayPal", secret: "MFZXI2LOM4======" },
  { name: "Dropbox", secret: "NRQXGZJTGI======" },
  { name: "Twitter", secret: "J5XW6Z3BOI======" },
  { name: "LinkedIn", secret: "KZQW2ZLTOR======" },
  { name: "Apple", secret: "L5RGG33OMY======" },
  { name: "AWS", secret: "NBSWY3DPFQQHO33S" },
  { name: "DigitalOcean", secret: "OBQXE4TBON2GK3TQ" },
  { name: "Heroku", secret: "MZXW6YTBOI======" },
  { name: "Slack", secret: "KRUGS4ZANFZSA===" },
  { name: "Discord", secret: "MVXGGZDFNZTSA===" },
  { name: "Telegram", secret: "JBSWY3DPK5XXE3DE" },
  { name: "WhatsApp", secret: "KRSXG5DSN5XWEZDF" },
  { name: "Notion", secret: "MFRGGZDFMZXXE3DE" },
  { name: "Cloudflare", secret: "ONSWG4TFOQXWEZDF" },
  { name: "Custom Service", secret: "JBSWY3DPEHPK3PXA" }
];

let activeSecret = null;

/* ===== BASE32 ===== */
function base32ToBytes(base32) {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
  let bits = "", bytes = [];
  base32 = base32.replace(/=+$/, "").toUpperCase();

  for (let c of base32) {
    const val = chars.indexOf(c);
    if (val === -1) continue;
    bits += val.toString(2).padStart(5, "0");
  }

  for (let i = 0; i + 8 <= bits.length; i += 8) {
    bytes.push(parseInt(bits.substring(i, i + 8), 2));
  }

  return new Uint8Array(bytes);
}

/* ===== TOTP ===== */
async function generateTOTP(secret) {
  const key = await crypto.subtle.importKey(
    "raw",
    base32ToBytes(secret),
    { name: "HMAC", hash: "SHA-1" },
    false,
    ["sign"]
  );

  const counter = Math.floor(Date.now() / 1000 / 30);
  const buffer = new ArrayBuffer(8);
  new DataView(buffer).setUint32(4, counter);

  const hmac = new Uint8Array(
    await crypto.subtle.sign("HMAC", key, buffer)
  );

  const offset = hmac[hmac.length - 1] & 0xf;
  const code =
    ((hmac[offset] & 0x7f) << 24) |
    ((hmac[offset + 1] & 0xff) << 16) |
    ((hmac[offset + 2] & 0xff) << 8) |
    (hmac[offset + 3] & 0xff);

  return (code % 1e6).toString().padStart(6, "0");
}

/* ===== UI ===== */
async function showOTP(secret) {
  activeSecret = secret;
  document.getElementById("otpDisplay").textContent =
    await generateTOTP(secret);
}

function generateFromInput() {
  const key = document.getElementById("customKey").value.trim();
  if (key) showOTP(key);
}

/* ===== ACCOUNT BUTTONS ===== */
const container = document.getElementById("accounts");
accounts.forEach(acc => {
  const btn = document.createElement("button");
  btn.className = "account-btn";
  btn.textContent = acc.name;
  btn.onclick = () => showOTP(acc.secret);
  container.appendChild(btn);
});

/* ===== TIMER ===== */
function updateTimer() {
  const now = Math.floor(Date.now() / 1000);
  const remaining = 30 - (now % 30);
  document.getElementById("timeLeft").textContent = remaining;

  if (remaining === 30 && activeSecret) {
    showOTP(activeSecret);
  }
}

setInterval(updateTimer, 1000);
updateTimer();
</script>

</body>
</html>
